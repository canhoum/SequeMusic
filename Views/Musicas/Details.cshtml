@model SequeMusic.Models.Musica

@{
    ViewData["Title"] = "Detalhes da Música";
}

<h2>@Model.Titulo</h2>

<dl class="row">
    <dt class="col-sm-2">Álbum</dt>
    <dd class="col-sm-10">@Model.Album</dd>

    <dt class="col-sm-2">Ano</dt>
    <dd class="col-sm-10">@Model.AnoDeLancamento</dd>

    <dt class="col-sm-2">Artista</dt>
    <dd class="col-sm-10">@Model.Artista?.Nome_Artista</dd>

    <dt class="col-sm-2">Gênero</dt>
    <dd class="col-sm-10">@Model.Genero?.Nome</dd>
</dl>

@if (!string.IsNullOrWhiteSpace(Model.Letra))
{
    <h4>Letra da Música</h4>
    <pre style="white-space: pre-wrap; background-color: #f8f9fa; padding: 15px; border-radius: 5px;">
@Model.Letra
    </pre>
}

@if (!string.IsNullOrEmpty(Model.NomeFicheiroAudio))
{
    <h4>Ouvir Música</h4>
    <audio controls>
        <source src="~/uploads/@Model.NomeFicheiroAudio" type="audio/mpeg" />
        O seu browser não suporta áudio.
    </audio>
}
else
{
    <p><i>Sem ficheiro de áudio disponível.</i></p>
}

<h4>Streamings</h4>
<ul>
    @foreach (var s in Model.Streamings) {
        <li>@s.Plataforma: @s.NumeroDeStreams visualizações</li>
    }
</ul>

<h4>Comentários</h4>
@if (Model.Avaliacoes?.Any() == true)
{
    <ul>
        @foreach (var a in Model.Avaliacoes) {
            <li><strong>@a.Utilizador?.UserName:</strong> @a.Comentario (Rating: @a.Nota)</li>
        }
    </ul>
}
else
{
    <p class="text-muted">Ainda não existem comentários para esta música.</p>
}

@if (User.Identity.IsAuthenticated)
{
    <h5 class="mt-5">Adicionar Comentário</h5>
    <form asp-controller="Avaliacao" asp-action="Create" method="post" class="mt-3">
        <input type="hidden" name="MusicaID" value="@Model.ID" />

        <div class="mb-3">
            <label for="Comentario" class="form-label">Comentário</label>
            <textarea name="Comentario" class="form-control" rows="3" required></textarea>
        </div>

        <div class="mb-3">
            <label for="Nota" class="form-label">Nota (1 a 5)</label>
            <select name="Nota" class="form-select" required>
                <option value="">Selecione uma nota</option>
                @for (int i = 1; i <= 5; i++)
                {
                    <option value="@i">@i</option>
                }
            </select>
        </div>

        <button type="submit" class="btn btn-primary">
            <i class="bi bi-send"></i> Submeter Comentário
        </button>
    </form>
}
else
{
    <p class="text-muted mt-4">
        <i class="bi bi-lock-fill"></i> <a asp-area="Identity" asp-page="/Account/Login">Inicie sessão</a> para deixar um comentário.
    </p>
}

<p class="mt-4">
    <a asp-action="Edit" asp-route-id="@Model.ID">Editar</a> |
    <a asp-action="Index">Voltar à Lista</a>
</p>
